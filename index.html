<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Ministério de Louvor</title>
<link rel="manifest" href="/manifest.json" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" />
<style>
  body { background-color: #111827; color: #f9fafb; }
  .tab { padding: 0.75rem 1rem; cursor: pointer; }
  .tab.active { background-color: #1f2937; border-radius: 0.5rem; }
  .content { display: none; padding: 1rem; }
  .content.active { display: block; }
  .uniformes-container { display: flex; gap: 10px; overflow-x: auto; padding-top: 0.5rem; }
  .uniforme-item img { height: 100px; border-radius: 8px; }
  .admin-buttons { margin-top: 1rem; display: none; flex-wrap: wrap; }
  .admin-buttons button { background-color: #bb86fc; color: #000; padding: 0.5rem 1rem; border-radius: 0.5rem; margin-right: 0.5rem; margin-bottom: 0.5rem; }
  .repertorio-item, .escala-item, .ensaio-item, .informacao-item, .devocional-item { margin-bottom: 1rem; padding: 0.5rem; border: 1px solid #333; border-radius: 0.5rem; }
  .avatar { width: 50px; height: 50px; border-radius: 50%; object-fit: cover; margin-right: 0.5rem; }
</style>
</head>
<body class="font-sans">

<header class="p-4 bg-gray-900 text-center text-xl font-bold">Ministério de Louvor</header>

<nav class="flex justify-around bg-gray-800 p-2 flex-wrap">
  <div class="tab active" data-tab="repertorio">🎶 Repertório</div>
  <div class="tab" data-tab="escalas">📅 Escalas</div>
  <div class="tab" data-tab="minhas-escalas">👤 Minhas Escalas</div>
  <div class="tab" data-tab="ensaios">🎤 Ensaios</div>
  <div class="tab" data-tab="uniformes">👕 Uniformes</div>
  <div class="tab" data-tab="informacoes">ℹ️ Informações</div>
  <div class="tab" data-tab="devocional">📖 Devocional</div>
  <button id="login-admin" class="ml-2 bg-teal-500 px-2 py-1 rounded">Login Admin</button>
</nav>

<main class="p-4">
  <section id="repertorio" class="content active">
    <h2 class="text-lg font-bold mb-2">Repertório</h2>
    <div id="repertorio-list"></div>
  </section>
  <section id="escalas" class="content">
    <h2 class="text-lg font-bold mb-2">Escalas</h2>
    <div id="escalas-list"></div>
  </section>
  <section id="minhas-escalas" class="content">
    <h2 class="text-lg font-bold mb-2">Minhas Escalas</h2>
    <div id="minhas-escalas-list"></div>
  </section>
  <section id="ensaios" class="content">
    <h2 class="text-lg font-bold mb-2">Ensaios</h2>
    <div id="ensaios-list"></div>
  </section>
  <section id="uniformes" class="content">
    <h2 class="text-lg font-bold mb-2">Uniformes</h2>
    <div id="uniformes-list" class="uniformes-container"></div>
  </section>
  <section id="informacoes" class="content">
    <h2 class="text-lg font-bold mb-2">Informações</h2>
    <div id="informacoes-list"></div>
  </section>
  <section id="devocional" class="content">
    <h2 class="text-lg font-bold mb-2">Devocional</h2>
    <div id="devocional-list"></div>
  </section>
</main>

<div class="admin-buttons" id="admin-buttons">
  <button id="editar-repertorio">Editar Repertório</button>
  <button id="editar-escalas">Editar Escalas</button>
  <button id="editar-uniformes">Editar Uniformes</button>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
  import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
  import { getMessaging, getToken } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-messaging.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAKbyjKMXasFjnW1lrivsvBDS8AOfJp3ng",
    authDomain: "louvor-adoracao.firebaseapp.com",
    projectId: "louvor-adoracao",
    storageBucket: "louvor-adoracao.firebasestorage.app",
    messagingSenderId: "857119220809",
    appId: "1:857119220809:web:7f8fdbb991572222088b98",
    measurementId: "G-FQTFQPFN0X"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);
  const messaging = getMessaging(app);

  // Controle abas
  const tabs = document.querySelectorAll(".tab");
  const contents = document.querySelectorAll(".content");
  tabs.forEach(tab => tab.addEventListener("click", () => {
    tabs.forEach(t => t.classList.remove("active"));
    contents.forEach(c => c.classList.remove("active"));
    tab.classList.add("active");
    document.getElementById(tab.dataset.tab).classList.add("active");
  }));

  // Função para criar item HTML
  function criarItem(data, campos) {
    return campos.map(c => {
      if (c.key === "link_cifra") return `<p>${c.label}: <a href="${data[c.key]}" target="_blank" class="text-teal-400 underline">${data[c.key]}</a></p>`;
      if (c.key === "avatar") return `<div class="flex items-center mb-1"><img src="${data[c.key]}" class="avatar" alt="avatar"><span>${data.nome}</span></div>`;
      return `<p>${c.label}: ${data[c.key] || "-"}</p>`;
    }).join('');
  }

  async function carregarColecao(colecao, containerId, campos, horizontal=false) {
    const container = document.getElementById(containerId);
    container.innerHTML = '';
    const snapshot = await getDocs(collection(db, colecao));
    snapshot.forEach(doc => {
      const data = doc.data();
      const div = document.createElement('div');
      if(horizontal){
        div.classList.add('uniforme-item');
        div.innerHTML = `<img src="${data.image}" alt="${data.nome}">`;
      } else {
        div.classList.add(`${containerId}-item`);
        div.innerHTML = criarItem(data, campos);
      }
      container.appendChild(div);
    });
  }

  // Carregar abas
  carregarColecao("Repertorio","repertorio-list",[ {key:"nome", label:"Música"}, {key:"link_cifra", label:"Cifra"} ]);
  carregarColecao("Escalas","escalas-list",[ {key:"nome", label:"Nome"}, {key:"descricao", label:"Descrição"} ]);
  carregarColecao("MinhasEscalas","minhas-escalas-list",[ {key:"nome", label:"Nome"}, {key:"participacao", label:"Participação"} ]);
  carregarColecao("Ensaios","ensaios-list",[ {key:"nome", label:"Nome"}, {key:"horario", label:"Horário"} ]);
  carregarColecao("Uniformes","uniformes-list",[ {key:"nome", label:"Nome"}, {key:"image", label:"Imagem"} ], true );
  carregarColecao("Informacoes","informacoes-list",[ {key:"titulo", label:"Título"}, {key:"descricao", label:"Descrição"} ]);
  carregarColecao("Devocional","devocional-list",[ {key:"titulo", label:"Título"}, {key:"texto", label:"Texto"} ]);

  // Login Admin
  const loginButton = document.getElementById("login-admin");
  const adminButtons = document.getElementById("admin-buttons");
  loginButton.addEventListener("click", () => {
    const email = prompt("Email admin:");
    const password = prompt("Senha:");
    signInWithEmailAndPassword(auth,email,password)
      .then(() => { adminButtons.style.display = "flex"; alert("Login admin realizado!"); })
      .catch(err => alert("Erro no login admin: " + err.message));
  });

  // Notificações FCM
  getToken(messaging, { vapidKey: "SUA_VAPID_KEY_AQUI" })
    .then((currentToken) => { console.log("Token FCM:", currentToken); })
    .catch(err => console.log("Erro FCM:", err));

</script>
</body>
</html>
